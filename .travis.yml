language: cpp
cache:
  directories:
  - trailofbits/polytracker/polytracker/test/downloads

matrix:
  include:
  - os: linux
    dist: bionic    # ubuntu 18.04
    compiler: clang

  - os: linux
    dist: bionic    # ubuntu 18.04
    compiler: gcc

before_install:
- |
  set -exo pipefail

  # Use Python 3.7 and make sure it has the `venv` module
  pyenv global system 3.7.1  # https://github.com/travis-ci/travis-ci/issues/8363
  python3.7 -mvenv -h

  # install clang-7 and llvm-7 from the LLVM repos, as the official Ubuntu
  # packages have trouble with polytracker (?)
  wget https://apt.llvm.org/llvm.sh
  chmod +x llvm.sh
  sudo ./llvm.sh 7

install:
- make CC="$CC" CXX="$CXX" install

script:
- make -j"$(nproc)" check
